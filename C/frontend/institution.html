<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Institution</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>
    <link rel="stylesheet" href="table.css" />

    <style>
      body {
        background: linear-gradient(to bottom, rgb(0, 115, 255), rgb(245, 62, 25));
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        height: 100vh; /* Ensure the body takes up the full height of the viewport */
        overflow: hidden; /* Prevent scrolling */
      }
    </style>


   
  </head>
  <body>
<div style="display: flex; align-items: center; justify-content: space-between">
      <h1>Greetings Educator from InstituteName</h1>
      <script>
        // Retrieve institution name from session storage
        const institutionName = sessionStorage.getItem("institutionName");

        // Update the text content of the h1 element with the institution name
        document.getElementById("institutionName").textContent = institutionName || "Greetings Educator from InstituteName";

        // Other JavaScript code...
    </script>
      <button class="btn btn-outline-success" type="button" id="signoutbutton">
        Sign Out
      </button>
    </div>

    <h2 id="msg"></h2>
    <h2 id="greet"></h2>

    <section>    <!--exams table-->
    <div class="tbl-header">
      <table cellpadding="0" cellspacing="0" border="0">
        <thead>
          <tr>
            <th>Exam</th>
            <th>Date</th>
            <th>Max Marks</th>
            <th>Avg Marks</th>
            <th>Contestants</th>
            <th>Results</th>
            <th>remove</th>
          </tr>
        </thead>
      </table>
    </div>
    <div class="tbl-content">
      <table cellpadding="0" cellspacing="0" border="0">
        <tbody>
          <tr>
            <td>Data</td>
            <td>Comes </td>
            <td>here</td>
            <td>automatically</td>
            <td>on</td>
            <td>opening</td>
            <td>throw</td>
          </tr>
        </tbody>
      </table>
    </div>
    </section>

    <a href="examcreate.html" class="btn btn-primary" id="createButton">
      Create
    </a>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

    <script>  // to ensure valid session and signout button functionality (can be used in all pages)
      var jwt = sessionStorage.getItem("jwt");
      console.log(jwt);
      let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
      //alert("Welcome, " + UserCreds);
      let UserInfo = sessionStorage.getItem("user");
      //let MsgHead = document.getElementById("msg");//let GreetHead = document.getElementById("greet");

      //to ensure valid session
      window.addEventListener('load', function() {
        if (!sessionStorage.getItem("jwt")) {
          alert("You are not signed in!");
          //window.location.href = "signin.html";
        }
      });

      //signout button functionality
      document.getElementById("signoutbutton").addEventListener("click", function() {
        sessionStorage.removeItem("user-creds");
        sessionStorage.removeItem("user");
        sessionStorage.removeItem("jwt");
        window.location.href = "signin.html";
      });
    </script>

    <script>
      // for the table
      $(window).on("load resize ", function() {
        var scrollWidth = $('.tbl-content').width() - $('.tbl-content table').width();
        $('.tbl-header').css({'padding-right':scrollWidth});
      }).resize();

      // Send a GET request to the server when the page loads
      $(document).ready(function() 
      {
        $.ajax({
          url: 'http://127.0.0.1:8000/view',
          method: 'GET',
          headers: 
          {
            'Authorization': 'Bearer ' + sessionStorage.getItem('jwt')
          },
          success: function(data) 
          {
            // Fill the table with the response
            var tbody = $('.tbl-content tbody');
            data.forEach(function(item) {
              var row = $('<tr>');
              row.append($('<td>').text(item.name));
              row.append($('<td>').text(item.date));
              row.append($('<td>').text(item.max_marks));
              row.append($('<td>').text(item.avg_marks || 'N/A'));
              row.append($('<td>').text(item.contestants));

              var resultLink = $('<a href="viewexam.html">üëÅ‚Äçüó®</a>');
              resultLink.on('click', function() {
                sessionStorage.setItem('exam_name', item.name);
                sessionStorage.setItem('qstn_count', item.qstn_count); // for column generation in viewexam.html
              });
              var resultCell = $('<td>');
              resultCell.append(resultLink);
              row.append(resultCell);
                 
                  
              // Create a link for exam deletion
              var deleteLink = $('<a href="#" class="delete-link">üöÆ</a>');
              deleteLink.on('click', function() 
              {
                  // Handle exam deletion here
                  // For example, you can prompt the user for confirmation and then remove the row from the table
                  var confirmation = confirm("Are you sure you want to delete this exam?");
                  if (confirmation) 
                  {

                  //var examName = $(this).closest('tr').find('td:eq(0)').text();
                  //var url = `/delete/${examName}`;
                  var confirmation = confirm("Are you sure you want to delete exam: "+item.name);
                  var itnm=item.name;
                  var url=`http://127.0.0.1:8000/delete/${itnm}`;
                  if (confirmation)
                  {
                      $.ajax
                      ({
                        url: url,
                        method: 'DELETE',
                        headers:
                        {
                          'Content-Type': 'application/json',
                          'Authorization': 'Bearer ' + sessionStorage.getItem('jwt')
                        },
                        success: function() 
                        {
                          // Reload the page to update the table
                          location.reload();
                        },
                        error: function() 
                        {
                          alert('Error deleting exam');
                        }
                      });


                    }   
                  }

                  return false; // Prevent the default action of the link
              });  
                  var delCell = $('<td>');
                  delCell.append(deleteLink);
                  row.append(delCell);
                  

                  
              tbody.append(row);
                          });
          }
        });
      });
    </script>


  </body>
</html>