<!DOCTYPE html>
<html>
<head>
    <title>Create Exam</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../frontend/css/bootstrap.min.css">
</head>
<body>
    <div id="examForm" class="m-3 ">
        <input type="text" id="examName" placeholder="Exam Name" class="m-3">
        <input type="date" id="examDate" class="m-3">
        <input type="number" id="questionCount" placeholder="Question Count" class="m-3">
        <input type="number" id="maxMarks" placeholder="Max Marks" class="m-3">
        <button id="createExam" class="m-3">Create Exam</button>
    </div>
    <div id="answersheet">

    </div>
    <div id="submitbutton"></div>
        <button id="submitAnswerKey" style="display: none;">Submit Answer Key</button>
    </div>
    <script>

        $(document).ready(function() {

            var jwt = sessionStorage.getItem("jwt");
            console.log(jwt);

            $("#createExam").click(function() {

                // get all the necessary data to send request
                var examData = {
                    "name": $("#examName").val(),
                    "date": $("#examDate").val(),
                    "qstn_count": $("#questionCount").val(),
                    "max_marks": $("#maxMarks").val()
                }

                // send post request to backend
                $.ajax({
                    url: 'http://127.0.0.1:8000/exam/create',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(examData),                    
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Authorization", "Bearer " + jwt);
                    },
                    success: function(data) {
                        console.log(data);
                        sessionStorage.setItem("table_name", data.table_name);
                        // $("#submitAnswerKey").show(); and dynamically create form should actually come here
                    }
                });

                $("#submitAnswerKey").show();

                // dynamically create form based on question count 
                for (let i = 0; i < $("#questionCount").val(); i++) {
                    $("#answersheet").append(` 
                        <div class="m-3">
                        <br>Question ${i+1}:<br>
                        Answer___: <input type="text" id="ans${i+1}"><br>
                        Marks: <input type="number" id="mark${i+1}"><br>
                        <div/>
                    `);
                }
            });


            $("#submitAnswerKey").click(function() {

                // get all the necessary data to send request
                var table_name = sessionStorage.getItem("table_name");
                var answerKeyData = {};
                for (let i = 0; i < $("#questionCount").val(); i++) {
                    answerKeyData["ans" + (i + 1)] = $("#ans" + (i + 1)).val();
                    answerKeyData["mark" + (i + 1)] = parseInt($("#mark" + (i + 1)).val(), 10);
                }
                //console.log(answerKeyData);

                // send post request to backend
                $.ajax({
                    url: 'http://127.0.0.1:8000/exam/anskey/' + table_name,
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(answerKeyData),
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Authorization", "Bearer " + jwt);
                    },
                    success: function(data) {
                        console.log(data);
                        // remove anskey forms & button
                        // upload answers form should appear
                    }
                });
            });

            

        });

    
    </script>
</body>
</html>